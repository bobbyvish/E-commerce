{% extends 'template.html'%}{% block mainpage %}
{% comment %}
<br>
<br>
<div class="container mt-5">
    <div class="row">
        <div class="col-md-4 order-md-2 mb-4">

            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-muted">Your cart</span>
                <span class="badge badge-secondary badge-pill" id="checkoutcartcount">2</span>
            </h4>
            <ul class="list-group mb-3" id="checkoutcart">

                <li class="list-group-item d-flex justify-content-between lh-condensed">
                    <img src="" height="45px" class="d-inline" alt="">
                    <div class="d-inline w-100 mx-3">
                        <h6 class="my=0">ejfkhefhh</h6>
                        <small class="text-muted"> Qty: <span class="checkqty">4</span><span class="checkid"
                                hidden="">0010019</span></small>
                    </div>
                    <span class="text-muted">700</span>
                </li>

                {% endcomment %}
                {% comment %} <li class="list-group-item d-flex justify-content-between lh-condensed">
                    <img src="" height="45px" class="d-inline" alt="">
                    <div class="d-inline w-100 mx-3">
                        <h6 class="my=0">Game Of Thrones</h6>
                        <small class="text-muted">Size: <span class="checksize">XS</span> | Qty: <span
                                class="checkqty">2</span><span class="checkid" hidden="">0010004</span></small>
                    </div>
                    <span class="text-muted">700</span>
                </li> {% endcomment %}
                {% comment %}
            </ul>
            <ul class="list-group mb-3">
                <li class="list-group-item d-flex justify-content-between lh-condensed">
                    <div>
                        <h6 class="my-0">Shipping</h6>
                    </div>
                    <span class="text-muted ship">50</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                    <span>Total (INR)</span>
                    <strong id="checkoutcarttotal">

                    </strong>
                </li>
            </ul>
        </div>

        <div class="col-md-8 order-md-1">
            <h4 class="mb-3">Billing address</h4>
            <form class="needs-validation" onsubmit="event.preventDefault(); checkout();">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="firstname">First name</label>
                        <input type="text" class="form-control" id="firstname" placeholder="" value="" required="">
                        <div class="invalid-feedback">
                            Valid first name is required.
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="lastname">Last name</label>
                        <input type="text" class="form-control" id="lastname" placeholder="" value="" required="">
                        <div class="invalid-feedback">
                            Valid last name is required.
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="phone">Phone Number</label>
                    <input type="text" class="form-control" id="phone" placeholder="" value="" required="">
                    <div class="invalid-feedback">
                        Valid phone number is required.
                    </div>
                </div>

                <div class="mb-3">
                    <label for="address1">Address</label>
                    <input type="text" class="form-control" id="address1" placeholder="1234 Main St" required="">
                    <div class="invalid-feedback">
                        Please enter your shipping address.
                    </div>
                </div>

                <div class="mb-3">
                    <label for="address2">Address 2 <span class="text-muted">(Optional)</span></label>
                    <input type="text" class="form-control" id="address2" placeholder="Apartment or suite">
                </div>

                <div class="row">
                    <div class="col-md-5 mb-3">
                        <label for="country">Country</label>
                        <select class="custom-select d-block w-100" id="country" required="">
                            <option value="">Choose...</option>
                            <option>India</option>
                        </select>
                        <div class="invalid-feedback">
                            Please select a valid country.
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="state">State</label>
                        <select class="custom-select d-block w-100" id="state" required="">
                            <option value="">Choose...</option>
                            <option>Maharashtra</option>
                        </select>
                        <div class="invalid-feedback">
                            Please provide a valid state.
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="zip">Zip</label>
                        <input type="text" class="form-control" id="zip" placeholder="" required="">
                        <div class="invalid-feedback">
                            Zip code required.
                        </div>
                    </div>
                </div>
                <hr class="mb-4">

                <h4 class="mb-3">Payment</h4> {% endcomment %}

                {% comment %} <div class="d-block my-3">
                    <div class="custom-control custom-radio" onclick="$('#creditdebit').show();">
                        <input id="credit" value="credit" name="paymentMethod" type="radio" class="custom-control-input"
                            checked="" required="">
                        <label class="custom-control-label" for="credit">Credit card</label>
                    </div>
                    <div class="custom-control custom-radio" onclick="$('#creditdebit').show();">
                        <input id="debit" value="debit" name="paymentMethod" type="radio" class="custom-control-input"
                            required="">
                        <label class="custom-control-label" for="debit">Debit card</label>
                    </div>
                    <div class="custom-control custom-radio" onclick="$('#creditdebit').hide();">
                        <input id="cod" value="cod" name="paymentMethod" type="radio" class="custom-control-input"
                            required="">
                        <label class="custom-control-label" for="cod">Cash On Delivery (COD)</label>
                    </div>
                </div>
                <div id="creditdebit">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="cc-name">Name on card</label>
                            <input type="text" class="form-control" id="cc-name" placeholder="">
                            <small class="text-muted">Full name as displayed on card</small>
                            <div class="invalid-feedback">
                                Name on card is required
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="cc-number">Credit card number</label>
                            <input type="text" class="form-control" id="cc-number" placeholder="">
                            <div class="invalid-feedback">
                                Credit card number is required
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label for="cc-expiration">Expiration</label>
                            <input type="text" class="form-control" id="cc-expiration" placeholder="">
                            <div class="invalid-feedback">
                                Expiration date required
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="cc-cvv">CVV</label>
                            <input type="text" class="form-control" id="cc-cvv" placeholder="">
                            <div class="invalid-feedback">
                                Security code required
                            </div>
                        </div>
                    </div>
                </div> {% endcomment %}
                {% comment %}
                <hr class="mb-4">
                <button class="btn btn-primary btn-lg btn-block" type="submit">Continue to checkout</button>
            </form>
        </div>
    </div>
</div>
<br>
<br> {% endcomment %}


<br>
<br>
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-6">
            <div class="box-element" id="form-wrapper">
                <form id="form">
                    <!-- <div id="user-info">
                        <div class="form-field m-2">
                            <input required class="form-control" type="text" name="name" placeholder="Name..">
                        </div>
                        <div class="form-field m-2">
                            <input required class="form-control" type="email" name="email" placeholder="Email..">
                        </div>
                    </div> -->

                    <div id="shipping-info">
                        <hr>
                        <p>Shipping Information:</p>
                        <hr>
                        <div class="form-field m-2">
                            <input class="form-control" type="text" name="address" placeholder="Address..">
                        </div>
                        <div class="form-field m-2">
                            <input class="form-control" type="text" name="city" placeholder="City..">
                        </div>
                        <div class="form-field m-2">
                            <input class="form-control" type="text" name="state" placeholder="State..">
                        </div>
                        <div class="form-field m-2">
                            <input class="form-control" type="text" name="zipcode" placeholder="Zip code..">
                        </div>
                    </div>
                    <hr>
                    <input id="form-button" class="btn btn-success btn-block" type="submit" value="Continue">
                </form>
            </div>
            <br>
            <div class="box-element hidden" id="payment-info">
                <small>Paypal Options</small>
                <button id="make-payment" class="btn btn-success">Make payment</button>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="box-element">
                <a class="btn btn-outline-dark" href="">&#x2190; Back to Cart</a>
                <hr>
                <h3>Order Summary</h3>

                <hr>
                <h5>Items: {{order.get_cart_items}}</h5>
                <h5>Total: {{order.get_cart_total}}Rs</h5>
                <hr>
                {% for item in items %}
                <div class="cart-row d-flex">
                    <div style="flex:2"><img class="row-image" src="{{item.product.Image.url}}"></div>
                    <div style="flex:2">
                        <p>{{item.product.Pname}}</p>
                    </div>
                    <div style="flex:1">
                        <p>{{item.product.Price}}</p>
                    </div>
                    <div style="flex:1">
                        <p>{{item.quantity}}</p>
                    </div>
                </div>
                {% endfor %}

            </div>

        </div>
    </div>
</div>

<script type="text/javascript">
    var total="{{order.get_cart_total}}"
    var form = document.getElementById('form')
    form.addEventListener('submit', function (e) {
        e.preventDefault()
        console.log('form submitted')
        document.getElementById('form-button').classList.add('hidden')
        document.getElementById('payment-info').classList.remove('hidden')
    })

    document.getElementById('make-payment').addEventListener('click', function (e) {
        submitFormData()
    })

    function submitFormData() {
        var shippingInfo={

            'address': null,
            'city': null,
            'state':null,
            'zipcode':null,
            'total': total,
        }
        if (user){
            shippingInfo.address=form.address.value
            shippingInfo.city=form.city.value
            shippingInfo.state=form.state.value
            shippingInfo.zipcode=form.zipcode.value

        }
        console.log(shippingInfo)

        var url= '/process_order/'
        fetch(url,{
            method:'Post',
            headers:{
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body:JSON.stringify({'shippingInfo':shippingInfo})
        })
        .then((response) => {
             response.json()
        })
        .then((data)=>{
            console.log('Success:',data);
            alert('Transaction Completed');
            window.location.href= '/home' ;
        }
        )



    }
</script>
{% endblock %}